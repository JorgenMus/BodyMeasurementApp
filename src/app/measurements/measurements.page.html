<ion-header [translucent]="true">
  <ion-toolbar>

    <div class="title-block">
      <div class="title-main">Measurements</div>
      <div class="title-sub">
        @if (selectedUser) {
          {{ selectedUser.name }}
        } @else {
          No user selected
        }
      </div>
    </div>

    <ion-buttons slot="end">
      <ion-button (click)="openCreateMeasurement()">
        Add
      </ion-button>
    </ion-buttons>

  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  @if (!selectedUserId) {
    <div class="ion-padding ion-text-center">
      <p>No user selected.</p>
      <ion-button (click)="goToUsers()">Go to Users</ion-button>
    </div>
  } @else {

    @if (measurements.length === 0) {
      <div class="ion-padding ion-text-center">
        <p>No measurements yet.</p>
        <ion-button (click)="openCreateMeasurement()">Add first measurement</ion-button>
      </div>
    } @else {

      <ion-list>
        @for (m of measurements; track m.measurementId) {
          <ion-item>
            <ion-label>
              <h2>{{ m.measurementDateISO }}</h2>
              <div class="pills">
                @for (f of getDisplayFields(m); track f.label) {
                  <span class="pill">
                    {{ f.label }}: {{ f.value }} @if (f.unit) { {{ f.unit }} }
                  </span>
                }

                @if (getDisplayFields(m).length === 0) {
                  <span class="pill empty">No values</span>
                }
              </div>

            </ion-label>

            <ion-button
              slot="end"
              fill="clear"
              color="danger"
              (click)="deleteMeasurement(m.measurementId)"
            >
              Delete
            </ion-button>
          </ion-item>
        }
      </ion-list>
    }
  }
</ion-content>